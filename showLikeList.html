<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 폰트어썸 -->
    <script src="https://kit.fontawesome.com/247e9f18da.js" crossorigin="anonymous"></script>
    <!-- 스와이퍼 -->
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet" href="./css/adminPage.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="icon" href="./image/logo.svg" />
    <link href="https://webfontworld.github.io/SCoreDream/SCoreDream.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>개인 페이지</title>
    <style>
      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 50px;
      }

      .button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        /* 버튼 배경색 */
        color: #dd4342; /* 버튼 텍스트 색상 */
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s;
        border: 1px solid #dd4342;
        background: none;
      }

      .button.selected {
        /* 선택된 버튼 배경색 */
        border-color: #dd4342; /* 선택된 버튼 테두리색 */
        background-color: #dd4342;
        color: white;
      }

      .button:hover:not(.selected) {
        background-color: #dd4342; /* 마우스 호버 시 배경색 */
        color: white;
      }

      .content {
        display: none;
      }

      .content.show {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="container">
      <!-- 왼쪽 목록 -->
      <div id="left_div">
        <a href="index.php">
          <div id="homeBtn">
            <i class="fa-solid fa-house"></i>
            <p>홈페이지</p>
          </div>
        </a>
        <!-- 각종 컨텐츠들 -->
        <div id="content">
          <!-- 동그란 원 -->
          <div class="profImg">
            <img src="./image/userImg.png" alt="프로필 사진" />
          </div>
          <!-- 이름 -->
          <div><h1 id="name1"></h1></div>
          <!-- 이메일 -->
          <div style="margin: 0"><h3 id="email1"></h3></div>
          <!-- 비밀번호 수정 -->
          <div id="passRewrite">
            <a href="passwordEdit.html" target="_self">
              <p id="p1">
                비밀번호 수정
                <i class="fa-solid fa-pen" style="font-size: 16px"></i>
              </p>
            </a>
          </div>
        </div>
        <div id="god" style="cursor: pointer"><i class="fa-solid fa-arrow-right-from-bracket"></i>로그아웃</div>
      </div>
      <!-- 오른쪽 목록 -->
      <div id="right_div">
        <div>
          <div class="button-group">
            <button class="button selected" onclick="selectButton(1)">식당 찜목록</button>
            <button class="button" onclick="selectButton(2)">공연 찜목록</button>
          </div>
          <!-- 식당찜목록 타이틀 -->
          <section id="foodSect" class="content show">
            <h1>식당 찜목록</h1>
            <div id="foodWrap">
              <!-- 캐러셀 -->
              <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                  <div class="swiper-slide">Slide 1</div>
                  <div class="swiper-slide">Slide 2</div>
                  <div class="swiper-slide">Slide 3</div>
                  <div class="swiper-slide">Slide 4</div>
                </div>
                <div class="swiper-pagination"></div>
              </div>
            </div>
            <article id="infoArticle">
              <h2>식당이름</h2>
              <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
              <div class="iconWrap">
                <div>
                  <i class="fa-solid fa-car"></i>
                  <p>주차 가능</p>
                </div>
                <div>
                  <i class="fa-solid fa-book-open"></i>
                  <p>예약 가능</p>
                </div>
                <div>
                  <i class="fa-solid fa-shapes"></i>
                  <p>놀이시설 있음</p>
                </div>
              </div>
              <div class="infoWrap">
                <div><i class="fa-solid fa-location-crosshairs"></i>주소 ㅁㄴㅇㄻㄴㅇㄻㄴㅇㄹ</div>
                <div><i class="fa-solid fa-phone"></i>전화번호ㅁㄴㅇㄻㄴㅇㄹ</div>
                <div><i class="fa-regular fa-clock"></i>영업시간ㅁㄴㅇㄹ</div>
              </div>
              <div class="menuWrap">
                <div>
                  <p>메뉴이름</p>
                  <p>50000원</p>
                </div>
                <div>
                  <p>메뉴이름</p>
                  <p>50000원</p>
                </div>
              </div>
            </article>
          </section>
          <!-- 공연 찜목록 -->
          <div class="content">
            <h1 id="JJimH1">공연 찜목록</h1>
            <div id="showList">
              <div id="show_title_div">
                <div id="consertList">
                  <h2>대구콘서트하우스</h2>
                  <p class="noHeartTxt">즐겨찾기한 항목이 없습니다.</p>
                </div>
                <!-- 아트플러스씨어터 -->
                <div id="artList">
                  <h2>아트플러스씨어터</h2>
                  <p class="noHeartTxt">즐겨찾기한 항목이 없습니다.</p>
                </div>
                <!-- 라이크디즈위드 -->
                <div id="likeList">
                  <h2>라이크디즈위드</h2>
                  <p class="noHeartTxt">즐겨찾기한 항목이 없습니다.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- 스와이퍼 js -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
      var swiper = new Swiper(".mySwiper", {
        loop: true,
        slidesPerView: 1,
        spaceBetween: 30,
        freeMode: true,
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
        breakpoints: {
          620: {
            slidesPerView: 2,
          },
          1550: {
            slidesPerView: 3,
          },
        },
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const username = sessionStorage.getItem("username");
        getUserInfo(username);
        getUserList(username);
      });
      function getUserInfo(username) {
        $.ajax({
          url: "http://dongseong.dothome.co.kr/mypage.php?username=" + encodeURIComponent(username),
          type: "GET",
          dataType: "json",
          success: function (response) {
            if (response.success) {
              //   console.log("이건", response.userInfo); // 사용자 정보를 받아옴
              document.getElementById("name1").innerText = response.userInfo.name;
              document.getElementById("email1").innerText = response.userInfo.email;
              if (!/010/.test(response.userInfo.tel)) {
                // '010'이 포함되어 있지 않은 경우
                // 여기에 처리할 내용을 작성하세요.
                document.getElementById("p1").style.display = "none";
              } else {
                document.getElementById("p1").style.display = "block";
              }

              // getUserList 호출
            } else {
              alert(response.message);
            }
          },
          error: function (xhr, status, error) {
            console.error("AJAX 요청 중 오류 발생:", error);
          },
        });
      }
      function getUserList(username) {
        // 사용자의 공연 정보를 가져오는 AJAX 요청
        $.ajax({
          url: "http://dongseong.dothome.co.kr/mypage.php?username=" + encodeURIComponent(username),
          type: "GET",
          dataType: "json",
          success: function (response) {
            if (response.success) {
              function addItem(item, listId) {
                document.querySelector(listId).innerHTML += `<p>
                  <button class="delBtn">
                    <i class="fa-solid fa-xmark fa-xl"></i>
                  </button>
                  <span class="showTit">${item.showname}</span>
                  <span>${item.showtime.trim().split("\n").join("")}</span>
                </p>`;
              }
              response.showInfo.map((item) => {
                if (item.showplace.includes("콘서트")) {
                  addItem(item, "#consertList");
                } else if (item.showplace.includes("씨어터")) {
                  addItem(item, "#artList");
                } else addItem(item, "#likeList");
              });
            } else {
              alert(response.message);
            }
          },
          error: function (xhr, status, error) {
            console.error("AJAX 요청 중 오류 발생:", error);
          },
        });
      }

      document.getElementById("god").addEventListener("click", function () {
        $.ajax({
          url: "http://dongseong.dothome.co.kr/logout.php",
          type: "POST",
          dataType: "json",
          success: function (response) {
            if (response.success) {
              alert(response.message);
              sessionStorage.removeItem("username");
              window.location.href = "index.php";
            } else {
              alert(response.message);
            }
          },
          error: function (xhr, status, error) {
            console.error("AJAX 요청 중 오류 발생:", error);
          },
        });
      });
    </script>
    <script>
      function selectButton(index) {
        var buttons = document.querySelectorAll(".button");
        var contents = document.querySelectorAll(".content");

        buttons.forEach(function (button, i) {
          if (i === index - 1) {
            button.classList.add("selected");
            contents[i].classList.add("show");
          } else {
            button.classList.remove("selected");
            contents[i].classList.remove("show");
          }
        });
      }

      // 공연 찜목록 있는지 확인, 있으면 대체 텍스트 삭제
      const observeMutation = (targetSelector) => {
        const observer = new MutationObserver((mutationsList, observer) => {
          mutationsList.forEach((mutation) => {
            if (mutation.type === "childList") {
              const target = document.querySelector(targetSelector);
              const noHeartTxt = target.querySelector(".noHeartTxt");
              if (noHeartTxt) {
                noHeartTxt.remove();
              }
            }
          });
        });

        const targetNode = document.querySelector(targetSelector);
        if (targetNode) {
          observer.observe(targetNode, {
            childList: true,
            subtree: true,
          });
        }
      };

      observeMutation("#consertList");
      observeMutation("#artList");
      observeMutation("#likeList");
    </script>
  </body>
</html>
