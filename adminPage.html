<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>관리자 페이지</title>
        <!-- 폰트어썸 -->
        <script src="https://kit.fontawesome.com/247e9f18da.js" crossorigin="anonymous"></script>
        <link rel="icon" href="./image/logo.svg" />
        <link rel="stylesheet" href="./css/adminPage.css" />
        <link href="https://webfontworld.github.io/SCoreDream/SCoreDream.css" rel="stylesheet" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        <div id="container">
            <!-- 왼쪽 목록 -->
            <div id="left_div" class="admin_left_div">
                <a href="index.php">
                    <div id="homeBtn">
                        <i class="fa-solid fa-house"></i>
                        <p>홈페이지</p>
                    </div>
                </a>
                <!-- 각종 컨텐츠들 -->
                <div id="content">
                    <!-- 동그란 원 -->
                    <div class="profImg">
                        <img src="./image/userImg.png" alt="프로필 사진" />
                    </div>
                    <!-- 이름 -->
                    <h1 id="adminName">관리자</h1>
                </div>
                <div id="god"><i class="fa-solid fa-arrow-right-from-bracket"></i>로그아웃</div>
            </div>
            <!-- 오른쪽 목록 -->
            <div id="right_div" class="admin_right_div">
                <div id="userInfoBig"></div>
            </div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const username = sessionStorage.getItem('username');
                getUserInfo(username);
            });

            function getUserInfo(username) {
                $.ajax({
                    url: 'http://dongseong.dothome.co.kr/mypage.php?username=' + encodeURIComponent(username),
                    type: 'GET',
                    dataType: 'json',
                    success: function (response) {
                        if (response.success) {
                            // console.log(response.userInfo); // 사용자 정보를 받아옴
                            // console.log(response.userInfo.name);
                            document.getElementById('adminName').innerText = response.userInfo.name;
                            // getUserList 호출
                            getUserList();
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('AJAX 요청 중 오류 발생:', error);
                    },
                });
            }
        </script>
        <script>
            function getUserList() {
                $.ajax({
                    url: 'http://dongseong.dothome.co.kr/userInfo.php',
                    type: 'GET',
                    dataType: 'json',
                    success: function (response) {
                        if (response.success) {
                            const userList = response.userList;
                            const userInfoBig = document.getElementById('userInfoBig');

                            // 사용자 목록을 순회하며 각 사용자 정보를 표시
                            userList.forEach(function (user) {
                                const userInfoBox = document.createElement('div');
                                userInfoBox.classList.add('userInfoBox');

                                const delBtn = document.createElement('button');
                                delBtn.classList.add('delBtn', 'delBtnAdmin');
                                delBtn.innerHTML = '<i class="fa-solid fa-xmark fa-2xl"></i>';
                                userInfoBox.appendChild(delBtn);

                                const userImg = document.createElement('div');
                                userImg.classList.add('userImg');
                                userImg.innerHTML = '<img src="" alt="" />';
                                userInfoBox.appendChild(userImg);

                                const userName = document.createElement('div');
                                userName.classList.add('userName');
                                userName.textContent = user.name;
                                userInfoBox.appendChild(userName);

                                const userId = document.createElement('div');
                                userId.classList.add('userId');
                                userId.textContent = user.uid;
                                userInfoBox.appendChild(userId);

                                const userMail = document.createElement('div');
                                userMail.classList.add('userMail');
                                userMail.textContent = user.email;
                                userInfoBox.appendChild(userMail);

                                const usedPhone = document.createElement('div');
                                usedPhone.classList.add('usedPhone');
                                usedPhone.textContent = user.tel;

                                // 전화번호가 '010'으로 시작하는지 확인
                                const startsWith010 = /^010/.test(user.tel);

                                // '010'으로 시작하는 경우에만 출력
                                if (startsWith010) {
                                    userInfoBox.appendChild(usedPhone);
                                }
                                userInfoBig.appendChild(userInfoBox);
                            });
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('AJAX 요청 중 오류 발생:', error);
                    },
                });
            }
        </script>
    </body>
</html>
